name: Checkmarx SCA Scan (Windows)

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  sca-scan:
    name: CxSCA Scan using Resolver (Windows)
    runs-on: windows-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v3

      - name: Download and unzip CxSCA Resolver (Windows)
        run: |
          curl -L -o ScaResolver.zip https://sca-downloads.s3.amazonaws.com/cli/latest/ScaResolver-win64.zip
          tar -xf ScaResolver.zip || powershell -Command "Expand-Archive -Path ScaResolver.zip -DestinationPath ."

      - name: Run CxSCA Scan (Windows)
        run: |
          .\ScaResolver.exe `
            --client-id "HarshGJ1" `
            --client-secret "dOhXWgcV6dy0jB3qVhqfmIn5n7pUnmrm" `
            --tenant "ast_abdul_ansari" `
            --base-uri "https://eu.ast.checkmarx.net" `
            --project-name "CxSCAResolver" `
            --scan-types sca `
            --include-sources . 
